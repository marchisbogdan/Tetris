"use strict";function genMatrix(){var e,t;for(e=1;e<=maxRow;e++)for(matrix[e]=[],t=1;t<=maxColl;t++)matrix[e][t]=0}function start(){play=!0,0===matrix.length&&genMatrix(),checkForFullRow(),block=generateBlock(),raiseScore(),showScore(),movingBlock=setInterval(reposition,intervalTime)}function stop(){play=!1,lastY+=1,lowerScore(),deleteLastPosition(),alert("Game stoped!")}function generateBlock(){var e=document.createElement("div");return e.className="active-block",e.style.background=generateBackgroundColor(),startingPoz.appendChild(e),nextAvailableCell=getnextAvailableCell(DIR.down,xAxis.default),setThePositions(startingRow,startingColl,startingRow,startingColl),e}function changeDirection(e){if(e=e||window.event,"37"==e.keyCode){if(verifyVacancy(DIR.left,xAxis.back)){try{moveTo(block,DIR.left,xAxis.back),setThePositions(currentRow,currentColl,nextRow-xAxis.back,nextColl+DIR.left,nextRow,nextColl+DIR.left)}catch(e){console.log(e)}deleteLastPosition()}}else if("39"==e.keyCode){if(verifyVacancy(DIR.right,xAxis.back)){try{moveTo(block,DIR.right,xAxis.back),setThePositions(currentRow,currentColl,nextRow-xAxis.back,nextColl+DIR.right,nextRow,nextColl+DIR.right)}catch(e){console.log(e)}deleteLastPosition()}}else if("40"==e.keyCode&&verifyVacancy(DIR.down,xAxis.default)){try{moveTo(block,DIR.down,xAxis.default),setThePositions(currentRow,currentColl,nextRow-xAxis.default,nextColl+DIR.down)}catch(e){console.log(e)}deleteLastPosition()}}function reposition(){if(play&&isGameOver()===!0)if(verifyVacancy(DIR.down,xAxis.default)){try{moveTo(block,DIR.down,xAxis.default),setThePositions(currentRow,currentColl,nextRow-xAxis.default,nextColl+DIR.down)}catch(e){console.log(e)}deleteLastPosition()}else block.className="positioned-block",matrix[currentRow][currentColl]=1,resetPositions(),clearInterval(movingBlock),start();else clearInterval(movingBlock),play=!0}function verifyVacancy(e,t){return!!(currentRow<maxRow&&currentColl+e>=minColl&&currentColl+e<=maxColl&&isPositionOpen(e,t))}function moveTo(e,t,o){if("undefined"==typeof e||null===e)throw new Error("Block is not defined!");if("undefined"==typeof t||null===t)throw new Error("The direction isn't specified!");"undefined"!=typeof o&&null!==o||(o=0);var l=document.createElement("div");l.className="active-block",l.style.background=block.style.background,matrix[currentRow][currentColl]=2,lastX=currentColl,lastY=currentRow,nextAvailableCell=getnextAvailableCell(t,o),nextAvailableCell.appendChild(l)}function deleteLastPosition(){matrix[lastY][lastX]=0;var e=document.getElementsByClassName("coll-"+lastX)[lastY-1];e.removeChild(e.children[0])}function isPositionOpen(e,t){return 0===matrix[nextRow][nextColl+e]}function setThePositions(e,t,o,l,n,r){e&&t&&null!==e&&null!==t&&(lastRow=e,lastColl=t),o&&l&&null!==o&&null!==l&&(currentRow=o,currentColl=l),n&&r&&null!==n&&null!==r?(nextRow=n,nextColl=r):(nextRow=currentRow+1,nextColl=currentColl)}function getnextAvailableCell(e,t){return"undefined"!=typeof e&&null!==e||(e=0),"undefined"!=typeof t&&null!==t||(t=0),document.getElementsByClassName("coll-"+(nextColl+e))[nextRow-t-1]}function generateBackgroundColor(){var e,t=randomNumber(0,4);return e=colors[t]}function resetPositions(){currentRow=startingRow,currentColl=startingColl,lastRow=startingRow,lastColl=startingColl,nextRow=startingRow+1,nextColl=startingColl}function isGameOver(){for(var e=minColl;e<=maxColl;e++)if(1===matrix[1][e])return updateBestScore(),alert("Game Over"),detachEvents(),play=!1,!1;return!0}function checkForFullRow(){for(var e=!0,t=minColl;t<=maxColl;t++)1!==matrix[maxRow][t]&&(e=!1);e&&(clearLastRow(),repositionBlocks())}function clearLastRow(){for(var e=minColl;e<=maxColl;e++)matrix[maxRow][e]=0;for(var t=document.getElementsByClassName("rows")[maxRow-1],o=minColl-1;o<maxColl;o++){var l=t.children[o];l.removeChild(l.children[0])}}function repositionBlocks(){for(var e,t,o,l,n=maxRow-2;n>=1;n--){e=document.getElementsByClassName("rows")[n],t=document.getElementsByClassName("rows")[n+1];for(var r=minColl-1;r<maxColl;r++)o=e.children[r],o.children.length>0?(matrix[n+2][r+1]=1,l=t.children[r],l.appendChild(o.children[0]),matrix[n+1][r+1]=0):matrix[n+2][r+1]=0}}function raiseScore(){score+=1}function lowerScore(){score-=1}function updateBestScore(){if("undefined"!=typeof Storage){var e=(document.getElementsByClassName("score__best")[0],parseInt(localStorage.bestScore));!isNaN(e)&&score>e&&(localStorage.bestScore=score,alert("New Record:"+score+" points!"))}else alert("Your browser doesn't support Web Storage.")}function showScore(){var e=document.getElementsByClassName("score__current")[0],t=document.getElementsByClassName("score__best")[0];e.innerHTML="Score:"+score,localStorage.bestScore||(localStorage.bestScore=0),t.innerHTML="Best Score:"+localStorage.bestScore}function randomNumber(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function detachEvents(){document.getElementById("start").removeEventListener("click",start),document.getElementById("stop").removeEventListener("click",stop),document.removeEventListener("keydown",changeDirection)}!function(){var e=document.getElementById("start");e.addEventListener("click",start);var t=document.getElementById("stop");t.addEventListener("click",stop),document.addEventListener("keydown",changeDirection),genMatrix()}();var play=!0,DIR={left:-1,down:0,right:1},xAxis={back:1,default:0},intervalTime=800,block,movingBlock,startingRow=1,startingColl=6,currentRow=1,currentColl=6,lastRow=1,lastColl=6,nextRow=2,nextColl=6,lastX=6,lastY=1,startingPoz=document.getElementsByClassName("coll-"+startingColl)[0],lastPoz,nextAvailableCell,lastOccupiedCell,maxRow=15,maxColl=10,minColl=1,matrix=[],score=0,colors=["#be0000","#becf00","#2cbe00","#001ebe","#be009a"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhYmVsU2NyaXB0LmpzIl0sIm5hbWVzIjpbImdlbk1hdHJpeCIsImkiLCJqIiwibWF4Um93IiwibWF0cml4IiwibWF4Q29sbCIsInN0YXJ0IiwicGxheSIsImxlbmd0aCIsImNoZWNrRm9yRnVsbFJvdyIsImJsb2NrIiwiZ2VuZXJhdGVCbG9jayIsInJhaXNlU2NvcmUiLCJzaG93U2NvcmUiLCJtb3ZpbmdCbG9jayIsInNldEludGVydmFsIiwicmVwb3NpdGlvbiIsImludGVydmFsVGltZSIsInN0b3AiLCJsYXN0WSIsImxvd2VyU2NvcmUiLCJkZWxldGVMYXN0UG9zaXRpb24iLCJhbGVydCIsImJsb2NrR2VuIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwic3R5bGUiLCJiYWNrZ3JvdW5kIiwiZ2VuZXJhdGVCYWNrZ3JvdW5kQ29sb3IiLCJzdGFydGluZ1BveiIsImFwcGVuZENoaWxkIiwibmV4dEF2YWlsYWJsZUNlbGwiLCJnZXRuZXh0QXZhaWxhYmxlQ2VsbCIsIkRJUiIsImRvd24iLCJ4QXhpcyIsImRlZmF1bHQiLCJzZXRUaGVQb3NpdGlvbnMiLCJzdGFydGluZ1JvdyIsInN0YXJ0aW5nQ29sbCIsImNoYW5nZURpcmVjdGlvbiIsImV2ZW50Iiwid2luZG93Iiwia2V5Q29kZSIsInZlcmlmeVZhY2FuY3kiLCJsZWZ0IiwiYmFjayIsIm1vdmVUbyIsImN1cnJlbnRSb3ciLCJjdXJyZW50Q29sbCIsIm5leHRSb3ciLCJuZXh0Q29sbCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJyaWdodCIsImlzR2FtZU92ZXIiLCJyZXNldFBvc2l0aW9ucyIsImNsZWFySW50ZXJ2YWwiLCJkaXJlY3Rpb24iLCJnb0JhY2siLCJtaW5Db2xsIiwiaXNQb3NpdGlvbk9wZW4iLCJjdXJyZW50QmxvY2siLCJFcnJvciIsIm5ld0Jsb2NrIiwibGFzdFgiLCJwYXJlbnQiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwicmVtb3ZlQ2hpbGQiLCJjaGlsZHJlbiIsImN1cnJlbnRSIiwiY3VycmVudEMiLCJuZXh0UiIsIm5leHRDIiwiaW5jck5leHRSb3ciLCJpbmNyTmV4dENvbGwiLCJsYXN0Um93IiwibGFzdENvbGwiLCJjb2xvciIsInJhbmROciIsInJhbmRvbU51bWJlciIsImNvbG9ycyIsInVwZGF0ZUJlc3RTY29yZSIsImRldGFjaEV2ZW50cyIsImZ1bGwiLCJjbGVhckxhc3RSb3ciLCJyZXBvc2l0aW9uQmxvY2tzIiwidGhlTGFzdFJvdyIsInRkIiwic291cmNlUm93IiwiZGVzdFJvdyIsInNvdXJjZUNvbGwiLCJkZXN0Q29sbCIsInNjb3JlIiwiU3RvcmFnZSIsImJlc3RWYWx1ZSIsInBhcnNlSW50IiwibG9jYWxTdG9yYWdlIiwiYmVzdFNjb3JlIiwiaXNOYU4iLCJzY29yZUNvbnRhaW5lciIsImJlc3RTY29yZUNvbnRhaW5lciIsImlubmVySFRNTCIsIm1pblZhbCIsIm1heFZhbCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImdldEVsZW1lbnRCeUlkIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInN0YXJ0QnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN0b3BCdXR0b24iLCJsYXN0UG96IiwibGFzdE9jY3VwaWVkQ2VsbCJdLCJtYXBwaW5ncyI6IkFBQUEsWUE0RUEsU0FBQUEsYUFDQSxHQUFBQyxHQUFBQyxDQUNBLEtBQUFELEVBQUEsRUFBQUEsR0FBQUUsT0FBQUYsSUFFQSxJQURBRyxPQUFBSCxNQUNBQyxFQUFBLEVBQUFBLEdBQUFHLFFBQUFILElBQ0FFLE9BQUFILEdBQUFDLEdBQUEsRUFLQSxRQUFBSSxTQUNBQyxNQUFBLEVBQ0EsSUFBQUgsT0FBQUksUUFDQVIsWUFFQVMsa0JBQ0FDLE1BQUFDLGdCQUNBQyxhQUNBQyxZQUNBQyxZQUFBQyxZQUFBQyxXQUFBQyxjQUdBLFFBQUFDLFFBQ0FYLE1BQUEsRUFDQVksT0FBQSxFQUNBQyxhQUNBQyxxQkFDQUMsTUFBQSxnQkFPQSxRQUFBWCxpQkFDQSxHQUFBWSxHQUFBQyxTQUFBQyxj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QUQsYUFBQUMsVUFBQSxHQUVBRyxFQUFBQyxVQUFBLGNBQUFMLGFBQUFDLFVBR0EsUUFBQWxCLGNBQUF1QixFQUFBQyxHQUNBLE1BQUFDLE1BQUFDLE1BQUFELEtBQUFFLFVBQUFILEVBQUFELEVBQUEsR0FBQUEsR0FHQSxRQUFBcEIsZ0JBQ0E3RCxTQUFBc0YsZUFBQSxTQUFBQyxvQkFBQSxRQUFBekcsT0FDQWtCLFNBQUFzRixlQUFBLFFBQUFDLG9CQUFBLFFBQUE3RixNQUNBTSxTQUFBdUYsb0JBQUEsVUFBQXRFLGtCQW5hQSxXQUNBLEdBQUF1RSxHQUFBeEYsU0FBQXNGLGVBQUEsUUFDQUUsR0FBQUMsaUJBQUEsUUFBQTNHLE1BQ0EsSUFBQTRHLEdBQUExRixTQUFBc0YsZUFBQSxPQUNBSSxHQUFBRCxpQkFBQSxRQUFBL0YsTUFFQU0sU0FBQXlGLGlCQUFBLFVBQUF4RSxpQkFDQXpDLGNBR0EsSUFBQU8sT0FBQSxFQUNBMkIsS0FBQVksTUFBQSxFQUFBWCxLQUFBLEVBQUFxQixNQUFBLEdBSUFwQixPQUFBVyxLQUFBLEVBQUFWLFFBQUEsR0FJQXBCLGFBQUEsSUFLQVAsTUFJQUksWUFNQXlCLFlBQUEsRUFDQUMsYUFBQSxFQUNBUyxXQUFBLEVBQ0FDLFlBQUEsRUFDQTRCLFFBQUEsRUFDQUMsU0FBQSxFQUNBNUIsUUFBQSxFQUNBQyxTQUFBLEVBSUFlLE1BQUEsRUFDQWhELE1BQUEsRUFDQVcsWUFBQU4sU0FBQTZDLHVCQUFBLFFBQUE3QixjQUFBLEdBSUEyRSxRQUlBbkYsa0JBSUFvRixpQkFLQWpILE9BQUEsR0FDQUUsUUFBQSxHQUNBeUQsUUFBQSxFQUNBMUQsVUFDQTJGLE1BQUEsRUFJQVosUUFBQSxVQUFBLFVBQUEsVUFBQSxVQUFBIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblx0dmFyIHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0Jyk7XG5cdHN0YXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3RhcnQpO1xuXHR2YXIgc3RvcEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wJyk7XG5cdHN0b3BCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9wKTtcblx0Ly8gYWRkaW5nIHRoZSBldmVudCBmb3Iga2V5IHByZXNzXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBjaGFuZ2VEaXJlY3Rpb24pO1xuXHRnZW5NYXRyaXgoKTtcbn0pKCk7XG5cbnZhciBwbGF5ID0gdHJ1ZSxcbiAgICBESVIgPSB7IGxlZnQ6IC0xLCBkb3duOiAwLCByaWdodDogMSB9LFxuXG5cbi8vIGRpcmVjdGlvbnNcbnhBeGlzID0geyBiYWNrOiAxLCBkZWZhdWx0OiAwIH0sXG5cblxuLy8gdmFsdWVzIGZvciB2ZXJpY2FsIG1vdmVtZW50XG5pbnRlcnZhbFRpbWUgPSA4MDAsXG5cblxuLy8gdGhlIHBlcmlvZCBvZiB0aW1lIGZvciBhbiBpbnRlcnZhbCBmdW5jdGlvbiBjYWxsXG5cbmJsb2NrLFxuXG5cbi8vIHRoZSBjdXJyZW50IG1vdmluZyBibG9ja1xubW92aW5nQmxvY2ssXG5cblxuLy8gZm9yIHRoZSByZXBvc2l0aW9uaW5nIHRoZSBibG9jayBhZnRlciBhIGNlcnRhaW4gdGltZSBpbnRlcnZhbFxuXG4vLyB1c2VkIHRvIHRyYWNlIHRoZSBibG9jaywgKHVzaW5nIGluZGV4ZXMgdG8gaWRlbnRpZnkgdGhlIHJpZ2h0IHBvc2l0aW9uIGVhc2llcilcbnN0YXJ0aW5nUm93ID0gMSxcbiAgICBzdGFydGluZ0NvbGwgPSA2LFxuICAgIGN1cnJlbnRSb3cgPSAxLFxuICAgIGN1cnJlbnRDb2xsID0gNixcbiAgICBsYXN0Um93ID0gMSxcbiAgICBsYXN0Q29sbCA9IDYsXG4gICAgbmV4dFJvdyA9IDIsXG4gICAgbmV4dENvbGwgPSA2LFxuXG5cbi8vIHBvc2l0aW9ucyBpbiB0aGUgbWF0cml4XG5sYXN0WCA9IDYsXG4gICAgbGFzdFkgPSAxLFxuICAgIHN0YXJ0aW5nUG96ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29sbC0nICsgc3RhcnRpbmdDb2xsKVswXSxcblxuXG4vLyB0aGlzIGlzIGEgY29sdW1uIGluIHRoZSBmaXJzdCByb3cgb2YgdGhlIHRhYmxlXG5sYXN0UG96LFxuXG5cbi8vIHRoZSBsYXN0IHBvc2l0aW9uIG9mIHRoZSBtb3ZpbmcgYmxvY2tcbm5leHRBdmFpbGFibGVDZWxsLFxuXG5cbi8vIHRoZSBuZXh0IGF2YWlsYWJsZSBjZWxsIGZvciB0aGUgbW92aW5nIGJsb2NrXG5sYXN0T2NjdXBpZWRDZWxsLFxuXG5cbi8vIHRoZSBsYXN0IG9jY3VwaWVkIGNlbGwgZm9yIHRoZSBtb3ZpbmcgYmxvY2tcbi8vIGdsb2JhbCB2YXJzXG5tYXhSb3cgPSAxNSxcbiAgICBtYXhDb2xsID0gMTAsXG4gICAgbWluQ29sbCA9IDEsXG4gICAgbWF0cml4ID0gW10sXG4gICAgc2NvcmUgPSAwLFxuXG5cbi8vIGNvbG9ycyBmb3IgdGhlIGJsb2NrcyBiYWNrZ3JvdW5kXG5jb2xvcnMgPSBbJyNiZTAwMDAnLCAnI2JlY2YwMCcsICcjMmNiZTAwJywgJyMwMDFlYmUnLCAnI2JlMDA5YSddOyAvLyB0aGUgY29sb3JzIG9mIHRoZSBtb3ZpbmcgYmxvY2tcblxuZnVuY3Rpb24gZ2VuTWF0cml4KCkge1xuXHR2YXIgaSwgajtcblx0Zm9yIChpID0gMTsgaSA8PSBtYXhSb3c7IGkrKykge1xuXHRcdG1hdHJpeFtpXSA9IFtdO1xuXHRcdGZvciAoaiA9IDE7IGogPD0gbWF4Q29sbDsgaisrKSB7XG5cdFx0XHRtYXRyaXhbaV1bal0gPSAwO1xuXHRcdH1cblx0fVxufVxuXG5mdW5jdGlvbiBzdGFydCgpIHtcblx0cGxheSA9IHRydWU7XG5cdGlmIChtYXRyaXgubGVuZ3RoID09PSAwKSB7XG5cdFx0Z2VuTWF0cml4KCk7XG5cdH1cblx0Y2hlY2tGb3JGdWxsUm93KCk7XG5cdGJsb2NrID0gZ2VuZXJhdGVCbG9jaygpO1xuXHRyYWlzZVNjb3JlKCk7XG5cdHNob3dTY29yZSgpO1xuXHRtb3ZpbmdCbG9jayA9IHNldEludGVydmFsKHJlcG9zaXRpb24sIGludGVydmFsVGltZSk7XG59XG5cbmZ1bmN0aW9uIHN0b3AoKSB7XG5cdHBsYXkgPSBmYWxzZTtcblx0bGFzdFkgKz0gMTtcblx0bG93ZXJTY29yZSgpO1xuXHRkZWxldGVMYXN0UG9zaXRpb24oKTtcblx0YWxlcnQoXCJHYW1lIHN0b3BlZCFcIik7XG59XG5cbi8qXHJcblx0VGhlIGZ1bmN0aW9uIGNyZWF0ZXMgYSBibG9jaywgYW5kIHNldHMgYSBjb2xvciB0byB0aGUgYmxvY2sgYmVmb3JlIGFwcGVuZGluZ1xyXG5cdGl0IHRvIHRoZSBzdGFydGluZyBwb3NpdGlvbiBvZiB0aGUgYm9hcmRcclxuKi9cbmZ1bmN0aW9uIGdlbmVyYXRlQmxvY2soKSB7XG5cdHZhciBibG9ja0dlbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRibG9ja0dlbi5jbGFzc05hbWUgPSAnYWN0aXZlLWJsb2NrJztcblx0YmxvY2tHZW4uc3R5bGUuYmFja2dyb3VuZCA9IGdlbmVyYXRlQmFja2dyb3VuZENvbG9yKCk7XG5cdHN0YXJ0aW5nUG96LmFwcGVuZENoaWxkKGJsb2NrR2VuKTtcblx0bmV4dEF2YWlsYWJsZUNlbGwgPSBnZXRuZXh0QXZhaWxhYmxlQ2VsbChESVIuZG93biwgeEF4aXMuZGVmYXVsdCk7XG5cblx0c2V0VGhlUG9zaXRpb25zKHN0YXJ0aW5nUm93LCBzdGFydGluZ0NvbGwsIHN0YXJ0aW5nUm93LCBzdGFydGluZ0NvbGwpO1xuXG5cdHJldHVybiBibG9ja0dlbjtcbn1cblxuLypcclxuXHR0aGUgZnVuY3Rpb24gc3RhcnRzIHdoZW4gYSBrZXkgaXMgcHJlc3NlZCBhbmQgaXQgZGlyZWN0cyBhIHBhcnRpY3VsYXIgZXZlbnQgdG8gYSBjb3Jlc3BvbmRpbmcgY2FzZVxyXG4qL1xuZnVuY3Rpb24gY2hhbmdlRGlyZWN0aW9uKGV2ZW50KSB7XG5cdGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50O1xuXHQvL2NsZWFySW50ZXJ2YWwobW92aW5nQmxvY2spO1xuXHRpZiAoZXZlbnQua2V5Q29kZSA9PSAnMzcnKSB7XG5cdFx0Ly8gbGVmdCBhcnJvd1xuXHRcdGlmICh2ZXJpZnlWYWNhbmN5KERJUi5sZWZ0LCB4QXhpcy5iYWNrKSkge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0bW92ZVRvKGJsb2NrLCBESVIubGVmdCwgeEF4aXMuYmFjayk7XG5cdFx0XHRcdHNldFRoZVBvc2l0aW9ucyhjdXJyZW50Um93LCBjdXJyZW50Q29sbCwgbmV4dFJvdyAtIHhBeGlzLmJhY2ssIG5leHRDb2xsICsgRElSLmxlZnQsIG5leHRSb3csIG5leHRDb2xsICsgRElSLmxlZnQpO1xuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGVycik7XG5cdFx0XHR9XG5cdFx0XHRkZWxldGVMYXN0UG9zaXRpb24oKTtcblx0XHR9XG5cdH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PSAnMzknKSB7XG5cdFx0Ly8gcmlnaHQgYXJyb3dcblx0XHRpZiAodmVyaWZ5VmFjYW5jeShESVIucmlnaHQsIHhBeGlzLmJhY2spKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRtb3ZlVG8oYmxvY2ssIERJUi5yaWdodCwgeEF4aXMuYmFjayk7XG5cdFx0XHRcdHNldFRoZVBvc2l0aW9ucyhjdXJyZW50Um93LCBjdXJyZW50Q29sbCwgbmV4dFJvdyAtIHhBeGlzLmJhY2ssIG5leHRDb2xsICsgRElSLnJpZ2h0LCBuZXh0Um93LCBuZXh0Q29sbCArIERJUi5yaWdodCk7XG5cdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coZXJyKTtcblx0XHRcdH1cblx0XHRcdGRlbGV0ZUxhc3RQb3NpdGlvbigpO1xuXHRcdH1cblx0fSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09ICc0MCcpIHtcblx0XHQvLyBkb3duIGFycm93XG5cdFx0aWYgKHZlcmlmeVZhY2FuY3koRElSLmRvd24sIHhBeGlzLmRlZmF1bHQpKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRtb3ZlVG8oYmxvY2ssIERJUi5kb3duLCB4QXhpcy5kZWZhdWx0KTtcblx0XHRcdFx0c2V0VGhlUG9zaXRpb25zKGN1cnJlbnRSb3csIGN1cnJlbnRDb2xsLCBuZXh0Um93IC0geEF4aXMuZGVmYXVsdCwgbmV4dENvbGwgKyBESVIuZG93bik7XG5cdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coZXJyKTtcblx0XHRcdH1cblx0XHRcdGRlbGV0ZUxhc3RQb3NpdGlvbigpO1xuXHRcdH1cblx0fVxufVxuLypcclxuXHRpZiB0aGVyZSBpcyBhbiBhdmFpbGFibGUgcG9zaXRpb24gbmV4dCB0aGUgZnVuY3Rpb24gd2lsbCByZXBvc2l0aW9uIHRoZSBibG9jayxcclxuXHRvdGhlcndpc2UgaXQgd2lsbCBjbGVhciB0aGUgbGFzdCBwb3NpdGlvbiBhbmQgY3JlYXRlIGEgbmV3IGJsb2NrIGZyb20gdGhlIGJlZ2lubmluZ1xyXG4qL1xuZnVuY3Rpb24gcmVwb3NpdGlvbigpIHtcblxuXHRpZiAocGxheSAmJiBpc0dhbWVPdmVyKCkgPT09IHRydWUpIHtcblx0XHRpZiAodmVyaWZ5VmFjYW5jeShESVIuZG93biwgeEF4aXMuZGVmYXVsdCkpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdG1vdmVUbyhibG9jaywgRElSLmRvd24sIHhBeGlzLmRlZmF1bHQpO1xuXHRcdFx0XHRzZXRUaGVQb3NpdGlvbnMoY3VycmVudFJvdywgY3VycmVudENvbGwsIG5leHRSb3cgLSB4QXhpcy5kZWZhdWx0LCBuZXh0Q29sbCArIERJUi5kb3duKTtcblx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHRcdFx0fVxuXHRcdFx0ZGVsZXRlTGFzdFBvc2l0aW9uKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGJsb2NrLmNsYXNzTmFtZSA9ICdwb3NpdGlvbmVkLWJsb2NrJztcblx0XHRcdG1hdHJpeFtjdXJyZW50Um93XVtjdXJyZW50Q29sbF0gPSAxO1xuXHRcdFx0cmVzZXRQb3NpdGlvbnMoKTtcblx0XHRcdGNsZWFySW50ZXJ2YWwobW92aW5nQmxvY2spO1xuXHRcdFx0c3RhcnQoKTtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0Y2xlYXJJbnRlcnZhbChtb3ZpbmdCbG9jayk7XG5cdFx0cGxheSA9IHRydWU7XG5cdH1cbn1cblxuLy8gdmVyaWZ5IGlmIHRoZSBuZXh0IHBvc2l0aW9uIGluIGEgY2VydGFpbiBkaXJlY3Rpb24gaXMgb3BlblxuZnVuY3Rpb24gdmVyaWZ5VmFjYW5jeShkaXJlY3Rpb24sIGdvQmFjaykge1xuXHRpZiAoY3VycmVudFJvdyA8IG1heFJvdyAmJiBjdXJyZW50Q29sbCArIGRpcmVjdGlvbiA+PSBtaW5Db2xsICYmIGN1cnJlbnRDb2xsICsgZGlyZWN0aW9uIDw9IG1heENvbGwpIHtcblx0XHRpZiAoaXNQb3NpdGlvbk9wZW4oZGlyZWN0aW9uLCBnb0JhY2spKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdH1cblx0cmV0dXJuIGZhbHNlO1xufVxuLypcclxuIG1vdmVzIHRoZSBlbGVtZW50IHRvIGEgc3BlY2lmaWVkIGRpcmVjdGlvblxyXG4gQGN1cnJlbnRCbG9jayAtIHRoZSBsYXN0IGVsbWVudCBnZW5lcmV0ZWQuXHJcbiBAZGlyZWN0aW9uIC0gc3BlY2lmaWVzIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGJsb2NrXHJcbiBAZ29CYWNrIC0gc3BlY2lmaWVzIHRoZSBudW1iZXIgb2Ygcm93cyByb3dzIHRvIHdoaWNoIGEgYmxvY2sgaXMgc2V0IGJhY2tcclxuKi9cbmZ1bmN0aW9uIG1vdmVUbyhjdXJyZW50QmxvY2ssIGRpcmVjdGlvbiwgZ29CYWNrKSB7XG5cdGlmICh0eXBlb2YgY3VycmVudEJsb2NrID09PSAndW5kZWZpbmVkJyB8fCBjdXJyZW50QmxvY2sgPT09IG51bGwpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJCbG9jayBpcyBub3QgZGVmaW5lZCFcIik7XG5cdH1cblx0aWYgKHR5cGVvZiBkaXJlY3Rpb24gPT09ICd1bmRlZmluZWQnIHx8IGRpcmVjdGlvbiA9PT0gbnVsbCkge1xuXHRcdHRocm93IG5ldyBFcnJvcihcIlRoZSBkaXJlY3Rpb24gaXNuJ3Qgc3BlY2lmaWVkIVwiKTtcblx0fVxuXHRpZiAodHlwZW9mIGdvQmFjayA9PT0gJ3VuZGVmaW5lZCcgfHwgZ29CYWNrID09PSBudWxsKSB7XG5cdFx0Z29CYWNrID0gMDtcblx0fVxuXHR2YXIgbmV3QmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0bmV3QmxvY2suY2xhc3NOYW1lID0gJ2FjdGl2ZS1ibG9jayc7XG5cdG5ld0Jsb2NrLnN0eWxlLmJhY2tncm91bmQgPSBibG9jay5zdHlsZS5iYWNrZ3JvdW5kO1xuXG5cdC8vIHNldCBhIHRyYWNlIGluIHRoZSBtYXRyaXhcblx0bWF0cml4W2N1cnJlbnRSb3ddW2N1cnJlbnRDb2xsXSA9IDI7XG5cdGxhc3RYID0gY3VycmVudENvbGw7XG5cdGxhc3RZID0gY3VycmVudFJvdztcblx0bmV4dEF2YWlsYWJsZUNlbGwgPSBnZXRuZXh0QXZhaWxhYmxlQ2VsbChkaXJlY3Rpb24sIGdvQmFjayk7XG5cdC8vbGFzdE9jY3VwaWVkQ2VsbCA9IGdldG5leHRBdmFpbGFibGVDZWxsKGRpcmVjdGlvbiwgZ29CYWNrKTtcblxuXHRuZXh0QXZhaWxhYmxlQ2VsbC5hcHBlbmRDaGlsZChuZXdCbG9jayk7XG59XG5cbi8vIHRoaXMgZnVuY3Rpb24gcmVtb3ZlcyB0aGUgZmlyc3QgY2hpbGQgZWxlbWVudCBmcm9tIGEgc3BlY2lmaWVkIHBvc2l0aW9uIG9mIHRoZSB0YWJsZS5cbi8vIHVzZWQgdG8gZGVsZXRlIHRoZSBsYXN0IHBvc2l0aW9uIG9mIHRoZSBibG9jay5cbmZ1bmN0aW9uIGRlbGV0ZUxhc3RQb3NpdGlvbigpIHtcblx0Ly9kZWxldGUgdGhlIHRyYWNlIG9mIHRoZSBibG9jayBpbiB0aGUgbWF0cml4XG5cdG1hdHJpeFtsYXN0WV1bbGFzdFhdID0gMDtcblx0dmFyIHBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbGwtJyArIGxhc3RYKVtsYXN0WSAtIDFdO1xuXHRwYXJlbnQucmVtb3ZlQ2hpbGQocGFyZW50LmNoaWxkcmVuWzBdKTtcbn1cbi8qXHJcbiBcdGZ1bmN0aW9uIGNoZWNrcyBpZiBhIHRhcmdldGVkIHBvc2l0aW9uIGlzIGVtcHR5XHJcbiBcdEBkaXJlY3Rpb24gLSBzcGVjaWZpZXMgdGhlIGRpcmVjdGlvbiBvZiB0aGUgYmxvY2tcclxuIFx0QGdvQmFjayAtIHNwZWNpZmllcyBpZiB0aGUgYmxvY2sgc2hvdWxkIGdvIGJhY2sgb25lIHJvd1xyXG4qL1xuZnVuY3Rpb24gaXNQb3NpdGlvbk9wZW4oZGlyZWN0aW9uLCBnb0JhY2spIHtcblx0aWYgKG1hdHJpeFtuZXh0Um93XVtuZXh0Q29sbCArIGRpcmVjdGlvbl0gPT09IDApIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXHRyZXR1cm4gZmFsc2U7XG59XG5cbi8qIHNldHRpbmcgdGhlIGdsb2JhbCB2YXJpYWJsZXMgZm9yIHRoZSBibG9ja3MgcG9zaXRpb24qL1xuZnVuY3Rpb24gc2V0VGhlUG9zaXRpb25zKGN1cnJlbnRSLCBjdXJyZW50QywgbmV4dFIsIG5leHRDLCBpbmNyTmV4dFJvdywgaW5jck5leHRDb2xsKSB7XG5cdGlmIChjdXJyZW50UiAmJiBjdXJyZW50QyAmJiBjdXJyZW50UiAhPT0gbnVsbCAmJiBjdXJyZW50QyAhPT0gbnVsbCkge1xuXHRcdGxhc3RSb3cgPSBjdXJyZW50Ujtcblx0XHRsYXN0Q29sbCA9IGN1cnJlbnRDO1xuXHR9XG5cdGlmIChuZXh0UiAmJiBuZXh0QyAmJiBuZXh0UiAhPT0gbnVsbCAmJiBuZXh0QyAhPT0gbnVsbCkge1xuXHRcdGN1cnJlbnRSb3cgPSBuZXh0Ujtcblx0XHRjdXJyZW50Q29sbCA9IG5leHRDO1xuXHR9XG5cdGlmIChpbmNyTmV4dFJvdyAmJiBpbmNyTmV4dENvbGwgJiYgaW5jck5leHRSb3cgIT09IG51bGwgJiYgaW5jck5leHRDb2xsICE9PSBudWxsKSB7XG5cdFx0bmV4dFJvdyA9IGluY3JOZXh0Um93O1xuXHRcdG5leHRDb2xsID0gaW5jck5leHRDb2xsO1xuXHR9IGVsc2Uge1xuXHRcdG5leHRSb3cgPSBjdXJyZW50Um93ICsgMTtcblx0XHRuZXh0Q29sbCA9IGN1cnJlbnRDb2xsO1xuXHR9XG59XG5cbi8qXHJcbiAgcmV0dXJucyBhbiB0ZCBlbGVtZW50IHdoaWNoIHJlcHJlc2VudHMgdGhlIG5leHQgcG9zaXRpb25cclxuICBAZGlyZWN0aW9uIC0gc3BlY2lmaWVzIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGJsb2NrXHJcbiAgQGdvQmFjayAtIHNwZWNpZmllcyBpZiB0aGUgYmxvY2sgc2hvdWxkIGdvIGJhY2sgb25lIHJvd1xyXG4qL1xuZnVuY3Rpb24gZ2V0bmV4dEF2YWlsYWJsZUNlbGwoZGlyZWN0aW9uLCBnb0JhY2spIHtcblx0aWYgKHR5cGVvZiBkaXJlY3Rpb24gPT09ICd1bmRlZmluZWQnIHx8IGRpcmVjdGlvbiA9PT0gbnVsbCkge1xuXHRcdGRpcmVjdGlvbiA9IDA7XG5cdH1cblx0aWYgKHR5cGVvZiBnb0JhY2sgPT09ICd1bmRlZmluZWQnIHx8IGdvQmFjayA9PT0gbnVsbCkge1xuXHRcdGdvQmFjayA9IDA7XG5cdH1cblx0cmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbGwtJyArIChuZXh0Q29sbCArIGRpcmVjdGlvbikpW25leHRSb3cgLSBnb0JhY2sgLSAxXTtcbn1cblxuLypcclxuICBnZW5lcmF0ZSBhIGluZGV4IHdoaWNoIHdpbGwgcG9pbnQgdG8gYSBzcGVjaWZpYyBwb3NpdGlvbiBpbiBhbiBhcnJheSB3aXRoIGhleCBjb2xvcnMgYXMgc3RyaW5nc1xyXG4qL1xuZnVuY3Rpb24gZ2VuZXJhdGVCYWNrZ3JvdW5kQ29sb3IoKSB7XG5cdHZhciBjb2xvcixcblx0ICAgIHJhbmROciA9IHJhbmRvbU51bWJlcigwLCA0KTtcblx0Y29sb3IgPSBjb2xvcnNbcmFuZE5yXTtcblx0cmV0dXJuIGNvbG9yO1xufVxuXG4vKiByZXNldHMgdGhlIHBvc2l0aW9ucyB0byB0aGUgaW5pdGlhbCB2YWx1ZXMgKi9cbmZ1bmN0aW9uIHJlc2V0UG9zaXRpb25zKCkge1xuXHRjdXJyZW50Um93ID0gc3RhcnRpbmdSb3c7XG5cdGN1cnJlbnRDb2xsID0gc3RhcnRpbmdDb2xsO1xuXHRsYXN0Um93ID0gc3RhcnRpbmdSb3c7XG5cdGxhc3RDb2xsID0gc3RhcnRpbmdDb2xsO1xuXHRuZXh0Um93ID0gc3RhcnRpbmdSb3cgKyAxO1xuXHRuZXh0Q29sbCA9IHN0YXJ0aW5nQ29sbDtcbn1cblxuLy8gdGhlIGZ1bmN0aW9uIGNoZWNrcyBpZiB0aGUgZ2FtZSBpcyBvdmVyXG5mdW5jdGlvbiBpc0dhbWVPdmVyKCkge1xuXHRmb3IgKHZhciBpID0gbWluQ29sbDsgaSA8PSBtYXhDb2xsOyBpKyspIHtcblx0XHRpZiAobWF0cml4WzFdW2ldID09PSAxKSB7XG5cdFx0XHR1cGRhdGVCZXN0U2NvcmUoKTtcblx0XHRcdGFsZXJ0KFwiR2FtZSBPdmVyXCIpO1xuXHRcdFx0ZGV0YWNoRXZlbnRzKCk7XG5cdFx0XHRwbGF5ID0gZmFsc2U7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cdHJldHVybiB0cnVlO1xufVxuXG4vLyBjaGVja3MgaWYgdGhlIGxhc3Qgcm93IGlzIGZ1bGxcbmZ1bmN0aW9uIGNoZWNrRm9yRnVsbFJvdygpIHtcblx0dmFyIGZ1bGwgPSB0cnVlO1xuXHRmb3IgKHZhciBpID0gbWluQ29sbDsgaSA8PSBtYXhDb2xsOyBpKyspIHtcblx0XHRpZiAobWF0cml4W21heFJvd11baV0gIT09IDEpIGZ1bGwgPSBmYWxzZTtcblx0fVxuXHRpZiAoZnVsbCkge1xuXHRcdGNsZWFyTGFzdFJvdygpO1xuXHRcdHJlcG9zaXRpb25CbG9ja3MoKTtcblx0fVxufVxuXG4vLyBjbGVhcnMgdGhlIGxhc3Qgcm93XG4vLyB0cmlnZ2VyZWQgaWYgdGhlIGxhc3Qgcm93IGlzIGZ1bGxcbmZ1bmN0aW9uIGNsZWFyTGFzdFJvdygpIHtcblx0Ly9jbGVhciBtYXRyaXggbGFzdCByb3dcblx0Zm9yICh2YXIgaSA9IG1pbkNvbGw7IGkgPD0gbWF4Q29sbDsgaSsrKSB7XG5cdFx0bWF0cml4W21heFJvd11baV0gPSAwO1xuXHR9XG5cdC8vY2xlYXIgRE9NIHRhYmxlIGxhc3Qgcm93XG5cdHZhciB0aGVMYXN0Um93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncm93cycpW21heFJvdyAtIDFdO1xuXHRmb3IgKHZhciBqID0gbWluQ29sbCAtIDE7IGogPCBtYXhDb2xsOyBqKyspIHtcblx0XHR2YXIgdGQgPSB0aGVMYXN0Um93LmNoaWxkcmVuW2pdO1xuXHRcdHRkLnJlbW92ZUNoaWxkKHRkLmNoaWxkcmVuWzBdKTtcblx0fVxufVxuXG4vLyByZXBvc2l0aW9uIGFsbCB0aGUgYmxvY2tzIHdpdGggb25lIHBvc2l0aW9uIGxvd2VyIGFmdGVyIGNsZWFyaW5nIHRoZSBsYXN0IHJvd1xuZnVuY3Rpb24gcmVwb3NpdGlvbkJsb2NrcygpIHtcblx0dmFyIHNvdXJjZVJvdywgZGVzdFJvdywgc291cmNlQ29sbCwgZGVzdENvbGw7XG5cdGZvciAodmFyIGkgPSBtYXhSb3cgLSAyOyBpID49IDE7IGktLSkge1xuXHRcdHNvdXJjZVJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3Jvd3MnKVtpXTtcblx0XHRkZXN0Um93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncm93cycpW2kgKyAxXTtcblx0XHRmb3IgKHZhciBqID0gbWluQ29sbCAtIDE7IGogPCBtYXhDb2xsOyBqKyspIHtcblx0XHRcdHNvdXJjZUNvbGwgPSBzb3VyY2VSb3cuY2hpbGRyZW5bal07XG5cdFx0XHRpZiAoc291cmNlQ29sbC5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdC8vIG1vZGlmeSB0aGUgbWF0cml4XG5cdFx0XHRcdG1hdHJpeFtpICsgMl1baiArIDFdID0gMTtcblx0XHRcdFx0Ly8gYXBwZW5kIHRoZSBibG9jayBmcm9tIHRoZSB1cHBlciBlbGVtZW50IHRvIHRoZSBvbmUgcG9zaXRpb25lZCBsb3dlclxuXHRcdFx0XHRkZXN0Q29sbCA9IGRlc3RSb3cuY2hpbGRyZW5bal07XG5cdFx0XHRcdGRlc3RDb2xsLmFwcGVuZENoaWxkKHNvdXJjZUNvbGwuY2hpbGRyZW5bMF0pO1xuXHRcdFx0XHQvLyBtb2RpZnkgdGhlIG1hdHJpeFxuXHRcdFx0XHRtYXRyaXhbaSArIDFdW2ogKyAxXSA9IDA7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBtb2RpZnkgdGhlIG1hdHJpeFxuXHRcdFx0XHRtYXRyaXhbaSArIDJdW2ogKyAxXSA9IDA7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59XG4vKlxyXG5cdFRoaXMgZnVuY3Rpb24gcmlzZXMgdGhlIHNjb3JlIG9mIHRoZSBnYW1lLlxyXG4qL1xuZnVuY3Rpb24gcmFpc2VTY29yZSgpIHtcblx0c2NvcmUgKz0gMTtcbn1cblxuLypcclxuVGhpcyBmdW5jdGlvbiByaXNlcyB0aGUgc2NvcmUgb2YgdGhlIGdhbWUuXHJcbiovXG5mdW5jdGlvbiBsb3dlclNjb3JlKCkge1xuXHRzY29yZSAtPSAxO1xufVxuXG4vKlxyXG5cdFRoaXMgZnVuY3Rpb24gdmVyaWZpZXMgaWYgdGhlcmUgaXMgYSBiZXN0IHNjb3JlIGFuZCB1cGRhdGVzIGl0IGlmIHRoZSBjdXJyZW50XHJcblx0c2NvcmUgaXMgaGlnaGVyIHRoZW4gdGhlIGJlc3Qgb25lLlxyXG4qL1xuZnVuY3Rpb24gdXBkYXRlQmVzdFNjb3JlKCkge1xuXHRpZiAodHlwZW9mIFN0b3JhZ2UgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0dmFyIGJlc3RTY29yZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3Njb3JlX19iZXN0JylbMF07XG5cdFx0dmFyIGJlc3RWYWx1ZSA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5iZXN0U2NvcmUpO1xuXHRcdGlmICghaXNOYU4oYmVzdFZhbHVlKSAmJiBzY29yZSA+IGJlc3RWYWx1ZSkge1xuXHRcdFx0bG9jYWxTdG9yYWdlLmJlc3RTY29yZSA9IHNjb3JlO1xuXHRcdFx0YWxlcnQoXCJOZXcgUmVjb3JkOlwiICsgc2NvcmUgKyBcIiBwb2ludHMhXCIpO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRhbGVydChcIllvdXIgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgV2ViIFN0b3JhZ2UuXCIpO1xuXHR9XG59XG5cbi8qXHJcblx0VGhpcyBmdW5jdGlvbiBpbnRlcmFjdHMgd2l0aCB0aGUgRE9NIGFuZCBpbnNlcnRzIHRoZSBzcGVjaWZpYyB2YWx1ZXNcclxuXHRmb3IgdGhlIGN1cnJlbnQgc2NvcmUgYW5kIHRoZSBiZXN0IG9uZS5cclxuKi9cbmZ1bmN0aW9uIHNob3dTY29yZSgpIHtcblx0dmFyIHNjb3JlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2NvcmVfX2N1cnJlbnQnKVswXTtcblx0dmFyIGJlc3RTY29yZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3Njb3JlX19iZXN0JylbMF07XG5cblx0c2NvcmVDb250YWluZXIuaW5uZXJIVE1MID0gXCJTY29yZTpcIiArIHNjb3JlO1xuXHRpZiAoIWxvY2FsU3RvcmFnZS5iZXN0U2NvcmUpIHtcblx0XHRsb2NhbFN0b3JhZ2UuYmVzdFNjb3JlID0gMDtcblx0fVxuXHRiZXN0U2NvcmVDb250YWluZXIuaW5uZXJIVE1MID0gXCJCZXN0IFNjb3JlOlwiICsgbG9jYWxTdG9yYWdlLmJlc3RTY29yZTtcbn1cblxuZnVuY3Rpb24gcmFuZG9tTnVtYmVyKG1pblZhbCwgbWF4VmFsKSB7XG5cdHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4VmFsIC0gbWluVmFsICsgMSkgKyBtaW5WYWwpO1xufVxuXG5mdW5jdGlvbiBkZXRhY2hFdmVudHMoKSB7XG5cdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydCcpLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3RhcnQpO1xuXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcCcpLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3RvcCk7XG5cdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBjaGFuZ2VEaXJlY3Rpb24pO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2NyaXB0LmpzLm1hcFxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2NyaXB0LmpzLm1hcFxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2NyaXB0LmpzLm1hcFxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YmFiZWxTY3JpcHQuanMubWFwXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
